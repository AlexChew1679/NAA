1. rails new Authentication_App -T
2.rails g controller StaticPages index help
3. install gem 'foundation'
4.rails g foundation:install

      uncomment         @include motion-ui-transitions;
                        @include motion-ui-animations;    at stylesheets/foundation_and_overrides.scss

create : customized_style.scss

                          .columns {
                            text-align: center;

                          }

put       at index and help.html.erb

                          <div class = "row">
                            <div class = "small-12 medium-12 large-12 columns">     <= columns is linked to the above
                            <h1> Welcome to Authentication Page </h1>
                          </div>


2. Creat User Model

Paths are related to actions and are based on the CRUD model

i. rails g resource User first_name last_name email password_digest
                        invoke  active_record
                        create    db/migrate/20170519053026_create_users.rb
                        create    app/models/user.rb
                        invoke  controller
                        create    app/controllers/users_controller.rb
                        invoke    erb
                        create      app/views/users
                        invoke    helper
                        create      app/helpers/users_helper.rb
                        invoke    assets
                        invoke      coffee
                        create        app/assets/javascripts/users.coffee
                        invoke      scss
                        create        app/assets/stylesheets/users.scss
                        invoke  resource_route
                         route    resources :users

3. 1st and lastname validation  - users_controller.rb

class UsersController < ApplicationController


                                  def index
                                  end

                                  def new
                                    @user = User.new
                                  end

                                  def create
                                    @user = User.new
                                    if @user.save
                                      redirect_to root_path
                                    else
                                      render 'new'
                                  end
                                end


          at users/ new.html.erb : do this to create form          users are create using resource

                                <%= provide(:title, 'Sign Up') %>

                                <div class = "row">
                                  <div class ="small-10 small-centered medium-4 medium-centered columns">
                                    <h2 id= "sign_up" > Sign Up </h2>
                                    <%= form_for (@user) do |f| %>

                                      <%= f.label :first_name %>
                                      <%= f.text_field :first_name %>

                                      <%= f.label :last_name %>
                                      <%= f.text_field :last_name %>

                                      <%= f.label :email %>
                                      <%= f.email_field :email %>

                                      <%= f.label :password %>
                                      <%= f.password_field :password %>

                                      <%= f.label :password_confirmation, 'Please confirm password' %>
                                      <%= f.password_field :password_confirmation %>

                                      <%= f.submit 'Create Account', class: "expanded button" %>
                                    <%end%>
                                  </div>
                                </div>


Validates First Name last and email

create rspec

                                i.gem 'rspec-rails'
                                ii. rails g rspec:install
                                create  .rspec
                                create  spec
                                create  spec/spec_helper.rb
                                create  spec/rails_helper.rb


          at .rspec
          --color - to give the error message color

          --format documentation     => it give us more readable information when we test

at model user.rb

                                  class User < ApplicationRecord
                                    validates :first_name, presence: true
                                    validates :last_name, presence: true
                                    validates :email, presence: true
                                  end


create   spec/models/user_spec.rb

                                      require 'rails_helper'

                                      describe User, type: :model do
                                        describe 'validations' do

                                          before do
                                            @user = User.create(first_name: 'Alex', last_name: 'Chew', email: 'alex@alex.com')
                                          end

                                          it 'can be created' do
                                            expect(@user).to be_valid
                                          end

                                          it 'cannot be created without a first name' do
                                            @user.first_name = nil
                                            expect(@user).not_to be_valid
                                          end

                                          it 'cannot be created without a last name' do
                                            @user.last_name = nil
                                            expect(@user).not_to be_valid
                                            end

                                          it 'cannot be created without a email' do
                                            @user.email = nil
                                            expect(@user).not_to be_valid
                                              end

                                          it 'cannot have a short first_name' do
                                            @user.first_name = 'a' * 2
                                            expect(@user).not_to be_valid
                                              end

                                          it 'cannot have a long first_name' do
                                            @user.first_name = 'a' * 25
                                            expect(@user).not_to be_valid
                                              end

                                          it 'cannot have a short last_name' do
                                                @user.last_name = 'a' * 2
                                                expect(@user).not_to be_valid
                                                  end

                                          it 'cannot have a long last_name' do
                                                @user.last_name = 'a' * 25
                                                expect(@user).not_to be_valid
                                                  end
                                        end
                                      end

at model => user.rb

                                            class User < ApplicationRecord
                                              validates :first_name, presence: true, length: {minimum: 3, maximum: 20}
                                              validates :last_name, presence: true, length: {minimum: 3, maximum: 20}
                                              validates :email, presence: true
                                            end


            CURRENTLY THE EMAIL DOTNT HAVE A INDEX : rails g migration add_index_to_users_email

            at Migration file :

                                            class AddIndexToUsersEmail < ActiveRecord::Migration[5.0]
                                              def change
                                                add_index :users, :email, unique: true
                                              end
                                            end


Validates Email                           below are from user_spec.rb :

                                          it 'cannot have an invalid address' do
                                          invalid_addresses = %w[user@example,com user_at_foo.org user.name@example.
                                          foo@bar_baz.com foo@bar+baz.com]

                                          invalid_addresses.each do |invalid_address|
                                            @user.email = invalid_address
                                            expect(@user).not_to be_valid
                                            end
                                          end

                                          it 'must have a unique email address' do
                                            @user = User.new(first_name: 'Jane', last_name: 'Doe', email: 'PIERRE@example.com')
                                            expect(@user).not_to be_valid
                                          end


modify user.rb to

                                        class User < ApplicationRecord

                                          before_save {self.email = email.downcase}

                                          validates :first_name, presence: true, length: {minimum: 3, maximum: 20}
                                          validates :last_name, presence: true, length: {minimum: 3, maximum: 20}

                                          VALID_EMAIL_REGEX = /\A([\w+\-].?)+@[a-z\d\-]+(\.[a-z]+)*\.[a-z]+\z/i
                                          validates :email, presence: true, length: { minimum: 10, maximun: 50}, format: { with: VALID_EMAIL_REGEX },
                                              uniqueness: { case_sensitive: false }
                                        end

Validates Password                       user_spec.rb


1st uncomment gem 'bcrypt'
                                      it 'must have a non blank password' do
                                        @user.password = @user.password_confirmation = ' ' * 6
                                        expect(@user).not_to be_valid
                                      end

                                      it 'must have a password with a minimum length' do
                                        @user.password = @user.password_confirmation = 'a' * 5
                                        expect(@user).not_to be_valid
                                      end
modify user.rb to

                                  class User < ApplicationRecord

                                    before_save {self.email = email.downcase}

                                    validates :first_name, presence: true, length: {minimum: 3, maximum: 20}
                                    validates :last_name, presence: true, length: {minimum: 3, maximum: 20}

                                    VALID_EMAIL_REGEX = /\A([\w+\-].?)+@[a-z\d\-]+(\.[a-z]+)*\.[a-z]+\z/i
                                    validates :email, presence: true, length: { minimum: 10, maximun: 50}, format: { with: VALID_EMAIL_REGEX },
                                        uniqueness: { case_sensitive: false }

                                      has_secure_password   <= this is to apply to gem 'bcrypt' NOTE
                                      validates :password, presence: true, length: { minimum: 6 }
                                  end


                                  change this at the top of user_spec.rb ( add password)

                                    before do
                                    @user = User.create(first_name: 'Alex', last_name: 'Chew', email: 'alex@alex.com', password: 'foobar', password_confirmation: 'foobar')
                                    end


CREATE SHOW VIEW


                                      Rails.application.routes.draw do
                                        resources :users
                                        root 'static_pages#index'

                                        get '/help', to: 'static_pages#help'
                                        get 'signup', to: 'users#new'

                                        # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html
                                      end

              NOTE:  IF U CHECK RAILS ROUTES, THERE'S NO SIGNUP, IT DOESNT EXIST, SO WHEN U DO THE FOLLOWING

              get 'signup', to: 'users#new'     => IT WILL BRINGS localhost:3000/signup  to  users/new ( CONTROLLER: USERS, VIEW: NEW)



          stylesheets/customized_style.scss

                                        :root {
                                          font-size: calc(0.5em + 0.7vw);
                                        }

                                        h1.title {
                                        text-align: center;
                                         }

                                        //Signin forms
                                        #sign_up {
                                          margin-top: 1rem;
                                          text-align: center;
                                        }

          users/show.html.erb

                                      <%= provide(:title, @user.last_name) %>

                                      <div class="row">
                                        <div class="small-12 medium-12 columns">
                                         <h1 class="title">
                                          <%= gravatar_for @user %>
                                          <%= @user.first_name + ' ' + @user.last_name %>
                                          </h1>
                                        </div>
                                      </div>


        IMPORTANT :

          write: @user = User.new(params[:user]) is about the same as

          @user = User.new(first_name: 'John', last_name: 'Doe', email: 'doe@example.com', password: 'foobar', password_confirmation: 'foobar')



        modify users_controller.rb

                                    class UsersController < ApplicationController
                                          def index
                                          end

                                          def show
                                            @user = User.find(params[:id])
                                          end

                                          def new
                                            @user = User.new
                                          end

                                          def create
                                            @user = User.new(user_params)
                                            if @user.save
                                              redirect_to root_path
                                            else
                                              render 'new'
                                          end
                                        end

                                        private

                                        def user_params
                                        params.require(:user).permit(:first_name, :last_name, :email, :password, :password_confirmation)
                                        end
                                      end


error messages and banner messages

at application.html.erb =>

                                  <!DOCTYPE html>
                                  <html lang="en">
                                    <head>
                                      <meta charset="utf-8" />
                                      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                                      <title><%= content_for?(:title) ? yield(:title) : "Untitled" %></title>
                                      <%= stylesheet_link_tag    "application" %>
                                      <%= javascript_include_tag "application", 'data-turbolinks-track' => true %>
                                      <%= csrf_meta_tags %>
                                    </head>
                                    <body>
                                      <% if flash[:success] %>
                                          <div class="success callout" data-closable>
                                            <%= display_flash_messages %>                    <= NOTE
                                            <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
                                              <span aria-hidden="true">&times;</span>
                                            </button>
                                          </div>
                                      <% end %>
                                      <%= yield %>
                                    </body>
                                  </html>


NOTE:


Foundation Rails Helper Build Status  =>  gem 'foundation_rails_helper'
Gem for Rails 4.1+ applications that use the excellent Zurb Foundation framework.
Includes:
A custom FormBuilder that generates a form using the Foundation framework classes. It replaces the current form_for,
so there is no need to change your Rails code. Error messages are properly displayed.
A display_flash_messages helper method that uses Zurb Foundation Callout UI.   <= NOTE


create   views/shared/_error_messages.html.erb

                                  <% if @user.errors.any? %>
                                    <div class="alert callout">
                                      The form contains <%= pluralize(@user.errors.count, 'error') %>
                                    </div>
                                    <ul>
                                      <% @user.errors.full_messages.each do |msg| %>
                                          <li><%=msg%></li>
                                          <%end%>
                                        </ul>
                                      <%end%>


        customized_style.scss : add
        i.label.error
        ii. input.error
        iii. small.error
        iv. a.close
        v..success.callout


  TESTING THE SIGNUP FORM

  install 2 gems:

  gem 'factory_girl_rails'
  gem 'rails-controller-testing'

  update users_controller.rb

                                def index
                                end

                                def show
                                  @user = User.find(params[:id])
                                end

                                def new
                                  @user = User.new
                                end

                              def create
                                @user = User.new(user_params)
                                if @user.save
                                log_in @user
                                  flash[:success] = 'User created successfully'
                                  redirect_to @user
                                else
                                  render 'new'
                              end
                            end

                              private

                              def user_params
                              params.require(:user).permit(:first_name, :last_name, :email, :password, :password_confirmation)
                              end
                              end

  create : spec/factories/user.rb

                                FactoryGirl.define do       <= CREATE A VALID user
                                  factory :user do
                                    first_name 'John'
                                    last_name 'Doe'
                                    email 'john@example.com'
                                    password 'foobar'
                                    password_confirmation 'foobar'


                                  factory :invalid_user do     <= CREATE A INVALID user
                                    first_name 'J'
                                    last_name 'Doe'
                                    email 'john_at_example'
                                    password 'foo'
                                    password_confirmation 'bar'
                                  end
                                end
                                end

  create : spec/controllers/user_signup_spec.rb

                                          require 'rails_helper'

                                          describe UsersController, type: :controller do
                                            describe 'POST #create' do
                                              context 'with valid attributes' do
                                                it 'saves the new user in the database' do
                                                  expect {
                                                    process :create, method: :post, params: {user: FactoryGirl.attributes_for(:user)}
                                                  }.to change(User, :count).by(1)
                                                end

                                                it 'redirects to users/show' do
                                                  process :create, method: :post, params: {user: FactoryGirl.attributes_for(:user)}
                                                  expect(:user).to redirect_to user_path(assigns[:user])
                                                end
                                              end
                                            end


                                          end

                                          describe UsersController, type: :controller do
                                            describe 'POST #create' do
                                              context 'with valid attributes' do
                                                it 'does not saves the new user in the database' do
                                                  expect {
                                                    process :create, method: :post, params: {user: FactoryGirl.attributes_for(:invalid_user)}
                                                  }.not_to change(User, :count)
                                                end

                                                it "render the 'new' template" do
                                                  process :create, method: :post, params: {user: FactoryGirl.attributes_for(:invalid_user)}
                                                  expect(response).to render_template :new
                                                end
                                              end
                                            end
                                          end

create login form

rails g controller Sessions new

at  views/sessions/new.html.erb

                                              <% provide(:title, 'Log In') %>

                                              <h1 class="title">Log In</h1>

                                              <div class="row">
                                                <div class=" small-10 small-centered medium-4 medium-centered columns">
                                                  <%= form_for(:session, url: login_path) do |f| %>

                                                      <%= f.label :email %>
                                                      <%= f.email_field :email %>

                                                      <%= f.label :password %>
                                                      <%= f.password_field :password %>


                                                      <%= f.submit 'Log In', class: 'expanded button' %>

                                                      <p>New User? <%= link_to 'Sign Up Now!', signup_path %></p>

                                                  <% end %>
                                                </div>

                                            </div>

at application_controller.rb add

                                                class ApplicationController < ActionController::Base
                                                  protect_from_forgery with: :exception
                                                  include SessionsHelper  <= add here
                                                end

  at   app/helpers/sessions_helper.rb


                                        module SessionsHelper

                                          # Login in the given user

                                          def log_in(user)
                                            session[:user_id] = user.id
                                          end

                                          # Returns the current logged in user, if there is any
                                          def current_user
                                            #@current_user = @current_user || User.find_by(id: session[:user_id])
                                            @current_user ||= User.find_by(id: session[:user_id])
                                          end

                                          def logged_in?
                                            !current_user.nil?
                                          end
                                        #log out the current user
                                          def log_out
                                            session.delete(:user_id)
                                            @current_user = nil
                                          end
                                        end


            sessions_controller.rb  :

                                            class SessionsController < ApplicationController

                                              def new
                                              end

                                              def create
                                                user = User.find_by(email: params[:session][:email].downcase)
                                                if user && user.authenticate(params[:session][:password])
                                                  log_in user
                                                  redirect_to user
                                                  flash[:primary] = "You're now logged in"
                                                else
                                                  flash.now[:danger] = 'Invalid email/password combination'
                                                  render 'new'
                                                end
                                              end

                                              def destroy
                                                log_out
                                                redirect_to root_url
                                              end
    at config/routes.rb make sure

                                      Rails.application.routes.draw do
                                        get 'sessions/new'

                                        resources :users
                                        root 'users#new'

                                        get 'static_pages/help'
                                        get 'signup', to: 'users#new'

                                        get '/login', to: 'sessions#new'
                                        post '/login', to: 'sessions#create'
    => VERY IMPORTANT                   delete '/logout', to: 'sessions#destroy'

                                        # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html
                                      end


IS IMPORTANT IF YOU WANNA LOGOUT         <%= link_to 'Logout', logout_path, method: 'delete' %>
OR LOGIN                                    you're assigning '/logout'    to logout_path

to create update and edit  , modify user_controller.rb

                                                class UsersController < ApplicationController


                                                          def index
                                                          end

                                                          def show
                                                            @user = User.find(params[:id])
                                                          end

                                                          def new
                                                            @user = User.new
                                                          end

                                                          def create
                                                            @user = User.new(user_params)
                                                            if @user.save
                                                              flash[:success] = 'User created successfully'
                                                              redirect_to @user
                                                            else
                                                              render 'new'
                                                          end
                                                        end

                                                        def edit
                                                          @user = User.find(params[:id])
                                                        end

                                                          def update
                                                            @user = User.find(params[:id])
                                                            if @user.update_attributes(user_params)
                                                              # Handle a successful update.
                                                            else
                                                              render 'edit'
                                                            end
                                                          end

                                                        private

                                                        def user_params
                                                        params.require(:user).permit(:first_name, :last_name, :email, :password, :password_confirmation)
                                                        end
                                                      end

REMEMBER ME TOKEN

  rails g migration add_remember_digest_to_users remember_digest:string

  go to models/user.rb  add this at bottom

                                              def User.new_token    <=NOTE
                                                SecureRandom.urlsafe_base64
                                            end

    note: Class methods are for things which dont operate on an individual instance of a model or for cases where you dont have the instance available
          to you, example... you might have a class method to tidy up your DB such as User.purge_expired_users which would not apply to an individual
          user object




          at model/user.rb

                                      class User < ApplicationRecord

                                        attr_accessor :remember_token    <= added here

                                        before_save {self.email = email.downcase}

                                        validates :first_name, presence: true, length: {minimum: 3, maximum: 20}
                                        validates :last_name, presence: true, length: {minimum: 3, maximum: 20}

                                        VALID_EMAIL_REGEX = /\A([\w+\-].?)+@[a-z\d\-]+(\.[a-z]+)*\.[a-z]+\z/i
                                        validates :email, presence: true, length: { minimum: 10, maximun: 50}, format: { with: VALID_EMAIL_REGEX },
                                            uniqueness: { case_sensitive: false }

                                          has_secure_password
                                          validates :password, presence: true, length: { minimum: 6 }

                                          #return a random token   <= added from this line onwards
                                          def User.new_token
                                            SecureRandom.urlsafe_base64
                                          end

                                          #return a digest_token of a given string

                                          def User.digest(string)
                                          cost = ActiveModel::SecurePassword.min_cost ? BCrypt::Engine::MIN_COST : BCrypt::Engine.cost
                                          BCrypt::Password.create(string, cost: cost)
                                        end

                                        # remember a user token in the database for persistent sessions

                                          def remember
                                            self.remember_token =  User.new_token
                                            update_attribute(:remember_digest, User.digest(remember_token))
                                        end
                                      end


                                      cookies[:remember_token] = {value: remember_token, expires: 20.years.from_now.utc}
                                      cookies.permanent[:remember_token] = remember_token

                                      cookies[:user_id] = user.id
                                      cookies.permanent.signed [:user_id] = user.id

                                      User.find_by(id: cookies.signed[:user_id])


            =>  NOTE: please look at the video35 again: is complicated


PERMANANENT SESSION AND FORGET USER    => user.rb

                                    class User < ApplicationRecord

                                      attr_accessor :remember_token

                                      before_save {self.email = email.downcase}

                                      validates :first_name, presence: true, length: {minimum: 3, maximum: 20}
                                      validates :last_name, presence: true, length: {minimum: 3, maximum: 20}

                                      VALID_EMAIL_REGEX = /\A([\w+\-].?)+@[a-z\d\-]+(\.[a-z]+)*\.[a-z]+\z/i
                                      validates :email, presence: true, length: { minimum: 10, maximun: 50}, format: { with: VALID_EMAIL_REGEX },
                                          uniqueness: { case_sensitive: false }

                                        has_secure_password
                                        validates :password, presence: true, length: { minimum: 6 }

                                        #return a random token
                                        def User.new_token
                                          SecureRandom.urlsafe_base64
                                        end

                                        #return a digest_token of a given string

                                        def User.digest(string)
                                        cost = ActiveModel::SecurePassword.min_cost ? BCrypt::Engine::MIN_COST : BCrypt::Engine.cost
                                        BCrypt::Password.create(string, cost: cost)
                                      end

                                      # remember a user token in the database for persistent sessions

                                        def remember
                                          self.remember_token =  User.new_token
                                          update_attribute(:remember_digest, User.digest(remember_token))
                                      end
                                        #returns true if the given token matches the digest
                                        def authenticated?(remember_token)
                                          BCrypt::Password.new(remember_digest).is_password?(remember_token)
                                        end

                                        def forget
                                          update_attribute(:remember_digest, nil)
                                        end

                                    end

        sessions_controller.rb

                                    class SessionsController < ApplicationController

                                      def new
                                      end

                                      def create
                                        user = User.find_by(email: params[:session][:email].downcase)
                                        if user && user.authenticate(params[:session][:password])
                                          log_in user
                                          remember user    <= added here
                                          redirect_to user
                                          flash[:primary] = "You're now logged in"
                                        else
                                          flash.now[:danger] = 'Invalid email/password combination'
                                          render 'new'
                                        end
                                      end

                                      def destroy
                                        log_out
                                        redirect_to root_path
                                      end
                                    end

        helper/sessions_helper.rb

                                      module SessionsHelper

                                        # Login in the given user

                                        def log_in(user)
                                          session[:user_id] = user.id
                                        end

                                      #remember a user in a permanent session  #<= added this action NOTE
                                        def remember(user)
                                          user.remember
                                          cookies.permanent.signed[:user_id] = user.id
                                          cookies.permanent[:remember_token] = user.remember_token
                                        end

                                        def current_user?(user)
                                         user == current_user
                                       end

                                        # Returns the user corresponding to the remember token cookie   #<= added this action NOTE
                                        def current_user
                                          if (user_id = session[:user_id])
                                            #@current_user = @current_user || User.find_by(id: session[:user_id])
                                            @current_user ||= User.find_by(id: user_id)
                                          elsif (user_id = cookies.signed[:user_id])
                                            user = User.find_by(id: user_id)
                                            if user && user.authenticated?(:remember, cookies[:remember_token])
                                              log_in user
                                              @current_user = user
                                            end
                                          end
                                        end

                                        def logged_in?
                                          !current_user.nil?
                                        end

                                        def forget(user)   #<= added this action NOTE
                                          user.forget
                                          cookies.delete(:user_id)
                                          cookies.delete(:remember_token)
                                        end
                                      #log out the current user      #<= added this action NOTE
                                        def log_out
                                          forget(current_user)
                                          session.delete(:user_id)
                                          @current_user = nil
                                        end
                                      end


  Update USER         models/user.rb

                          VALID_EMAIL_REGEX = /\A([\w+\-].?)+@[a-z\d\-]+(\.[a-z]+)*\.[a-z]+\z/i
                          validates :email, presence: true, length: { minimum: 10, maximun: 50}, format: { with: VALID_EMAIL_REGEX },
                              uniqueness: { case_sensitive: false }

                            has_secure_password
                            validates :password, presence: true, length: { minimum: 6 }, allow_nil: true  <= modify only this line NOTE

        users_controller.rb

                            class UsersController < ApplicationController


                            before_action :logged_in_user, only: [:edit, :update]

                                      def index
                                        #Show all list users
                                        @user = User.all
                                        if params[:search]
                                          @user = User.search(params[:search]).order("created_at DESC")
                                        else
                                          @user = User.all.order('created_at DESC')
                                        end
                                      end

                                      def show
                                        @user = User.find(params[:id])
                                      end

                                      def new
                                        @user = User.new
                                      end

                                      def create
                                        @user = User.new(user_params)
                                        if @user.save

                                        log_in @user
                                          flash[:success] = 'User created successfully'
                                          redirect_to @user
                                        else
                                          render 'new'
                                      end
                                    end

                                    def edit
                                      @user = User.find(params[:id])
                                    end

                                    def update
                                      @user = User.find(params[:id])
                                      if @user.update_attributes(user_params)
                                        flash[:success] = 'User updated successfully'
                                        redirect_to @user
                                      else
                                        render 'edit'
                                      end
                                    end

                                    def destroy
                                      User.destroy(params[:id])

                                      redirect_to root_path
                                    end

                                    private

                                    def user_params
                                      params.require(:user).permit(:first_name, :last_name, :email, :password, :password_confirmation, :search)
                                    end

                                    def logged_in_user
                                      unless logged_in?
                                        flash[:alert] = 'Please login'
                                        redirect_to login_url
                                      end
                                    end

                                  end
